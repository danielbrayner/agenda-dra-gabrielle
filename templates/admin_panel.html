<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Administrativo - Dra. Gabrielle</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >

    <style>
        .top-bar {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 1rem;
        }

        .menu-central {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .top-bar {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }




    </style>
</head>

<body class="bg-light">

<div class="container py-4">

    <!-- TOPO -->
    <div class="top-bar mb-4">

        <h4 class="mb-0">üìã Painel da Dra. Gabrielle</h4>

        <div class="menu-central">
            <button class="btn btn-outline-primary btn-sm"
                    onclick="mostrarSecao('consultas')">
                Consultas agendadas
            </button>

            <button class="btn btn-outline-success btn-sm"
                    onclick="mostrarSecao('horarios')">
                Hor√°rios livres
            </button>

            <button class="btn btn-outline-secondary btn-sm"
                    onclick="mostrarSecao('novo')">
                Novo hor√°rio
            </button>
        </div>

        <a href="/admin/logout" class="btn btn-outline-danger btn-sm">
            Sair
        </a>

    </div>

    <!-- CONSULTAS -->
    <div id="consultas" class="card mb-4 secao">
        <div class="card-header bg-primary text-white">
            Consultas agendadas
        </div>
        <div class="card-body table-responsive">

            {% if consultas %}
            <form method="POST" action="/admin/excluir-consultas-lote#consultas">
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" onclick="toggleAll(this, 'consulta')">
                            </th>
                            <th>Data</th>
                            <th>Hor√°rio</th>
                            <th>Modalidade</th>
                            <th>Paciente</th>
                            <th>Telefone</th>
                            <th>Confirma√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for c in consultas %}
                        <tr>
                            <td>
                                <input type="checkbox" name="consulta_ids" value="{{ c.id }}" class="consulta">
                            </td>
                            <td>{{ c.data_formatada }}</td>
                            <td>{{ c.horario }}</td>
                            <td>{{ c.modalidade }}</td>
                            <td>{{ c.nome_paciente }}</td>
                            <td>{{ c.telefone }}</td>
                            <td>
                                <a
                                    href="https://wa.me/55{{ c.telefone | replace(' ', '') | replace('-', '') | replace('(', '') | replace(')', '') }}?text={{ (
                                        'Ol√°! Voc√™ tem uma consulta marcada com a Dra Gabrielle no dia '
                                        ~ c.data_formatada
                                        ~ ' √†s '
                                        ~ c.horario
                                        ~ ' na modalidade '
                                        ~ c.modalidade
                                        ~ '.\n\nLembrando que a Dra atende no Shopping Aldeota - Sala 1605. '
                                        ~ 'Caso sua consulta seja online, a Dra ir√° enviar um link no hor√°rio marcado.\n\n'
                                        ~ 'Posso confirmar sua consulta?'
                                    ) | urlencode }}"
                                    target="_blank"
                                    class="btn btn-success btn-sm"
                                    title="Enviar mensagem de confirma√ß√£o"
                                >
                                    üì≤ Confirmar
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <button class="btn btn-danger mt-2"
                        onclick="return confirm('Cancelar consultas selecionadas?')">
                    üóëÔ∏è Cancelar selecionadas
                </button>
            </form>
            {% else %}
            <p class="text-muted mb-0">Nenhuma consulta agendada.</p>
            {% endif %}

        </div>
    </div>

    <!-- HOR√ÅRIOS -->
    <div id="horarios" class="card mb-4 secao d-none">
        <div class="card-header bg-success text-white">
            Hor√°rios livres
        </div>
        <div class="card-body table-responsive">

            {% if horarios_livres %}
            <form method="POST" action="/admin/excluir-horarios-lote#horarios">
                <table class="table table-striped align-middle">
                    <thead>
                        <tr>
                            <th>
                                <input type="checkbox" onclick="toggleAll(this, 'horario')">
                            </th>
                            <th>Data</th>
                            <th>Hor√°rio</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for h in horarios_livres %}
                        <tr>
                            <td>
                                <input type="checkbox" name="horario_ids" value="{{ h.id }}" class="horario">
                            </td>
                            <td>{{ h.data_formatada }}</td>
                            <td>{{ h.horario }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <button class="btn btn-outline-danger mt-2"
                        onclick="return confirm('Excluir hor√°rios selecionados?')">
                    üóëÔ∏è Excluir selecionados
                </button>
            </form>
            {% else %}
            <p class="text-muted mb-0">Nenhum hor√°rio livre cadastrado.</p>
            {% endif %}

        </div>
    </div>

    <!-- NOVO -->
    <div id="novo" class="card secao d-none">
        <div class="card-header">
            ‚ûï Adicionar novo hor√°rio
        </div>
        <div class="card-body">
            {% if request.args.get('erro') == 'horario_existe' %}
            <div class="alert alert-danger">
                ‚ö†Ô∏è J√° existe um hor√°rio cadastrado para essa data e hor√°rio.
            </div>
            {% endif %}

            <form method="POST" action="/admin/adicionar-horario#novo">
                <div class="row g-3">
                    <div class="col-md-5">
                        <label class="form-label">Data</label>
                        <input
                            type="date"
                            name="data"
                            class="form-control"
                            value="{{ request.args.get('data', '') }}"
                            required
                        >
                    </div>

                    <div class="col-md-5">
                        <label class="form-label">Hor√°rio</label>
                        <input type="time" name="horario" class="form-control" required>
                    </div>

                    <div class="col-md-2 d-grid">
                        <button class="btn btn-primary">
                            Adicionar
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>

</div>

<script>
function toggleAll(master, classe) {
    document.querySelectorAll('.' + classe).forEach(cb => {
        cb.checked = master.checked;
    });
}

function mostrarSecao(id) {
    document.querySelectorAll('.secao').forEach(secao => {
        secao.classList.add('d-none');
    });

    document.getElementById(id).classList.remove('d-none');
    window.location.hash = id;
}

window.addEventListener('load', () => {
    const hash = window.location.hash.replace('#', '');
    if (hash) {
        mostrarSecao(hash);
    }
});
</script>

</body>
</html>
